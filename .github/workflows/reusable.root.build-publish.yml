on:
  workflow_dispatch:


jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    outputs:
      tag_version: ${{ steps.publish.outputs.tag_version }}
    permissions:
      id-token: write
      contents: read
    steps:
    - name: Install pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 9.15.4

    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Install Node
      uses: actions/setup-node@v4
      with:
        node-version: 22
        cache: 'pnpm'

    - name: Install Dependencies
      run: pnpm install

    - name: Bundle
      run: pnpm bundle

    - name: Publish
      id: publish
      run: pnpm publish --dry-run